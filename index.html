<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odiss√©ia Comportamental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
            color: #e2e8f0; /* text-slate-200 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        canvas {
            background-color: #020617; /* bg-slate-950 */
            border: 2px solid #334155; /* border-slate-700 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); /* shadow-lg */
            display: block;
            margin: 0 auto;
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold transition-all duration-200;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white shadow-md;
        }
        .btn-secondary {
            @apply bg-slate-700 hover:bg-slate-600 text-white shadow-md;
        }
        .btn-restart {
            @apply bg-green-600 hover:bg-green-700 text-white shadow-md;
        }
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto; /* Adicionado para permitir scroll em telas pequenas */
            padding: 1rem; /* Adicionado padding para melhor visualiza√ß√£o em mobile */
        }
        .modal-content {
            background: #1e293b; /* bg-slate-800 */
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px; /* Aumentado max-width para acomodar mais texto */
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.08);
            color: #e2e8f0;
            max-height: 90vh; /* Limita a altura do modal */
            overflow-y: auto; /* Permite scroll interno */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 flex flex-col items-center max-w-4xl">
        <h1 class="text-4xl font-bold mb-6 text-white text-center">Odiss√©ia Comportamental</h1>

        <div class="bg-slate-800 p-6 rounded-xl shadow-lg w-full mb-6">
            <div class="flex flex-wrap justify-between items-center mb-4 text-lg font-semibold">
                <div class="flex items-center space-x-2">
                    <span class="text-blue-400">‚õΩ Combust√≠vel:</span> <span id="fuelDisplay" class="text-white">100</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-red-400">‚ù§Ô∏è Integridade:</span> <span id="healthDisplay" class="text-white">100</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-green-400">üßë‚ÄçüöÄ Tripula√ß√£o:</span> <span id="crewDisplay" class="text-white">5</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-yellow-400">üéØ Miss√£o:</span> <span id="missionDisplay" class="text-white">1/5</span>
                </div>
            </div>
            <p id="messageDisplay" class="text-center text-xl text-slate-300 min-h-[4rem] flex items-center justify-center"></p>
        </div>

        <canvas id="gameCanvas" width="800" height="450" class="mb-6"></canvas>

        <div id="decisionPanel" class="bg-slate-800 p-6 rounded-xl shadow-lg w-full hidden">
            <h2 id="eventTitle" class="text-2xl font-bold mb-4 text-white">Evento!</h2>
            <p id="eventDescription" class="text-slate-300 mb-6"></p>
            <div id="optionsContainer" class="flex flex-col sm:flex-row gap-4">
                <button id="option1Btn" class="btn btn-primary flex-1"></button>
                <button id="option2Btn" class="btn btn-primary flex-1"></button>
            </div>
        </div>

        <button id="startGameBtn" class="btn btn-restart text-2xl px-8 py-4">Iniciar Odiss√©ia</button>
    </div>

    <!-- Modal para o Relat√≥rio de Perfil -->
    <div id="profileReportModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-4 text-center text-blue-400">Relat√≥rio de Perfil Comportamental</h2>
            <p class="text-lg mb-4 text-slate-300">Sua jornada pela Odiss√©ia Comportamental nos permitiu observar suas tend√™ncias. Veja o que notamos:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 text-base">

                <!-- Big Five -->
                <div class="bg-slate-700 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-300 mb-2">Big Five (OCEAN)</h3>
                    <p><strong class="text-white">Abertura:</strong> <span id="opennessProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Conscienciosidade:</strong> <span id="conscientiousnessProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Extrovers√£o:</strong> <span id="extraversionProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Amabilidade:</strong> <span id="agreeablenessProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Neuroticismo:</strong> <span id="neuroticismProfile" class="text-slate-200"></span></p>
                </div>

                <!-- DISC -->
                <div class="bg-slate-700 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-300 mb-2">DISC</h3>
                    <p><strong class="text-white">Domin√¢ncia:</strong> <span id="dominanceProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Influ√™ncia:</strong> <span id="influenceProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Estabilidade:</strong> <span id="steadinessProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Conformidade:</strong> <span id="complianceProfile" class="text-slate-200"></span></p>
                </div>

                <!-- Intelig√™ncias M√∫ltiplas -->
                <div class="bg-slate-700 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-300 mb-2">Intelig√™ncias M√∫ltiplas</h3>
                    <p><strong class="text-white">L√≥gico-Matem√°tica:</strong> <span id="logicalIntProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Interpessoal:</strong> <span id="interpersonalIntProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Intrapessoal:</strong> <span id="intrapersonalIntProfile" class="text-slate-200"></span></p>
                </div>

                <!-- Perfis de Lideran√ßa -->
                <div class="bg-slate-700 p-4 rounded-lg">
                    <h3 class="font-semibold text-blue-300 mb-2">Perfis de Lideran√ßa</h3>
                    <p><strong class="text-white">Direcionador:</strong> <span id="directingProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Coaching:</strong> <span id="coachingProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Apoiador:</strong> <span id="supportingProfile" class="text-slate-200"></span></p>
                    <p><strong class="text-white">Delegador:</strong> <span id="delegatingProfile" class="text-slate-200"></span></p>
                </div>

            </div>
            <p class="text-sm text-slate-400 italic text-center">Lembre-se: Este √© um jogo. Os resultados s√£o indicativos e baseados em suas escolhas dentro deste cen√°rio simulado. Uma avalia√ß√£o psicol√≥gica completa requer ferramentas validadas por especialistas.</p>
            <div class="flex justify-center mt-6">
                <button id="restartGameBtnModal" class="btn btn-restart">Reiniciar Jogo</button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais do jogo
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const fuelDisplay = document.getElementById('fuelDisplay');
        const healthDisplay = document.getElementById('healthDisplay');
        const crewDisplay = document.getElementById('crewDisplay');
        const missionDisplay = document.getElementById('missionDisplay');
        const messageDisplay = document.getElementById('messageDisplay');
        const decisionPanel = document.getElementById('decisionPanel');
        const eventTitle = document.getElementById('eventTitle');
        const eventDescription = document.getElementById('eventDescription');
        const option1Btn = document.getElementById('option1Btn');
        const option2Btn = document.getElementById('option2Btn');
        const startGameBtn = document.getElementById('startGameBtn');
        const profileReportModal = document.getElementById('profileReportModal');
        const restartGameBtnModal = document.getElementById('restartGameBtnModal');

        let gameRunning = false;
        let game = {
            fuel: 100,
            health: 100,
            crew: 5,
            currentMission: 1,
            maxMissions: 5,
            eventsCompleted: 0,
            playerShip: { x: canvas.width / 2, y: canvas.height / 2, size: 20 }
        };

        // Arrays para registrar o comportamento do jogador
        const behavioralLog = []; // { eventId, decision, timeTaken, initialFuel, initialHealth, initialCrew, outcome }
        let currentEventStartTime = 0;

        // --- Fun√ß√µes de Desenho no Canvas ---
        function drawShip() {
            ctx.fillStyle = '#67e8f9'; // cian-300
            ctx.beginPath();
            ctx.moveTo(game.playerShip.x, game.playerShip.y - game.playerShip.size);
            ctx.lineTo(game.playerShip.x + game.playerShip.size, game.playerShip.y + game.playerShip.size / 2);
            ctx.lineTo(game.playerShip.x - game.playerShip.size, game.playerShip.y + game.playerShip.size / 2);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = '#0891b2'; // cian-700
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawBackground() {
            ctx.fillStyle = '#020617'; // bg-slate-950
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            // Desenhar estrelas aleat√≥rias
            for (let i = 0; i < 100; i++) {
                ctx.fillStyle = 'rgba(255, 255, 255, ' + Math.random() + ')';
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 1.5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function updateCanvas() {
            drawBackground();
            drawShip();
        }

        // --- Fun√ß√µes de Jogo ---
        function updateUI() {
            fuelDisplay.textContent = game.fuel;
            healthDisplay.textContent = game.health;
            crewDisplay.textContent = game.crew;
            missionDisplay.textContent = `${game.currentMission}/${game.maxMissions}`;
        }

        function showMessage(msg, color = 'text-slate-300') {
            messageDisplay.textContent = msg;
            messageDisplay.className = `text-center text-xl min-h-[4rem] flex items-center justify-center ${color}`;
        }

        function endGame(status) {
            gameRunning = false;
            decisionPanel.classList.add('hidden');
            startGameBtn.classList.remove('hidden');
            startGameBtn.textContent = 'Reiniciar Jogo';

            if (status === 'win') {
                showMessage('Miss√£o Conclu√≠da! Voc√™ sobreviveu √† Odiss√©ia!', 'text-green-400');
            } else {
                showMessage('Sua nave foi destru√≠da ou a tripula√ß√£o perdida! Fim de Jogo.', 'text-red-400');
            }
            analyzeBehavior();
        }

        function checkGameEndConditions() {
            if (game.fuel <= 0 || game.health <= 0 || game.crew <= 0) {
                endGame('lose');
                return true;
            }
            if (game.currentMission > game.maxMissions) {
                endGame('win');
                return true;
            }
            return false;
        }

        // --- Eventos e Decis√µes ---
        const events = [
            {
                id: 'meteor_shower',
                title: 'Chuva de Meteoros!',
                description: 'Uma inesperada chuva de meteoros se aproxima. O que voc√™ faz?',
                options: [
                    {
                        text: 'Manobrar para desviar (Consome Combust√≠vel)',
                        action: () => {
                            game.fuel = Math.max(0, game.fuel - 20);
                            showMessage('Voc√™ manobrou com sucesso, mas gastou combust√≠vel.');
                            return 'manobrar_desviar';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { openness: 2, conscientiousness: -1, extraversion: 1, neuroticism: 1 },
                            disc: { dominance: 2, influence: 1 },
                            intelligences: { logical: -1 },
                            leadership: { directing: 1 }
                        }
                    },
                    {
                        text: 'Ativar escudos (Consome Integridade da Nave)',
                        action: () => {
                            game.health = Math.max(0, game.health - 15);
                            showMessage('Os escudos protegeram a nave, mas sofreram danos.');
                            return 'ativar_escudos';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { conscientiousness: 2, neuroticism: -1, openness: -1 },
                            disc: { conscientiousness: 1, steadiness: 1 },
                            intelligences: { logical: 1 },
                            leadership: { coaching: 1, supporting: 1 }
                        }
                    }
                ]
            },
            {
                id: 'distress_signal',
                title: 'Sinal de Socorro!',
                description: 'Voc√™ intercepta um sinal de socorro de uma nave danificada. Eles pedem ajuda.',
                options: [
                    {
                        text: 'Prestar socorro (Demora e consome recursos)',
                        action: () => {
                            game.fuel = Math.max(0, game.fuel - 25);
                            game.crew = Math.max(0, game.crew - 1); // Risco de perda de tripula√ß√£o
                            showMessage('Voc√™ ajudou, mas sua jornada foi mais lenta e perdeu um tripulante.');
                            return 'prestar_socorro';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { agreeableness: 2, openness: 1, conscientiousness: -1 },
                            disc: { influence: 2, steadiness: 1 },
                            intelligences: { interpersonal: 2, intrapersonal: -1 }, // Menos foco em si
                            leadership: { supporting: 2 }
                        }
                    },
                    {
                        text: 'Ignorar e seguir (Economiza recursos)',
                        action: () => {
                            showMessage('Voc√™ ignorou o sinal e continuou sua rota.');
                            return 'ignorar_sinal';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { conscientiousness: 1, agreeableness: -2, neuroticism: -1 }, // Foco na tarefa, menos empatia
                            disc: { dominance: 1, conscientiousness: 1 },
                            intelligences: { logical: 1, intrapersonal: 1 }, // Foco na pr√≥pria miss√£o
                            leadership: { directing: 1 }
                        }
                    }
                ]
            },
            {
                id: 'resource_planet',
                title: 'Planeta Rico em Recursos!',
                description: 'Voc√™ encontrou um planeta com recursos valiosos. Vale a pena desviar?',
                options: [
                    {
                        text: 'Explorar o planeta (Ganho de combust√≠vel, risco de dano)',
                        action: () => {
                            game.fuel += 30;
                            if (Math.random() < 0.3) { // 30% de chance de dano
                                game.health = Math.max(0, game.health - 10);
                                showMessage('Voc√™ coletou combust√≠vel, mas a explora√ß√£o causou pequenos danos.');
                                return 'explorar_com_dano';
                            } else {
                                showMessage('Explora√ß√£o bem-sucedida! Combust√≠vel extra.');
                                return 'explorar_sem_dano';
                            }
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { openness: 2, extraversion: 1, neuroticism: 1 }, // Buscar novidade, arriscar
                            disc: { dominance: 1, influence: 1 },
                            intelligences: { logical: 1 }, // Pensamento estrat√©gico de ganho
                            leadership: { directing: 1 } // Tomada de decis√£o de alto risco/recompensa
                        }
                    },
                    {
                        text: 'Seguir em frente (Sem ganho, sem risco)',
                        action: () => {
                            showMessage('Voc√™ seguiu seu curso principal, sem desvios.');
                            return 'seguir_em_frente';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { conscientiousness: 2, openness: -1, neuroticism: -1 }, // Efici√™ncia, evitar riscos
                            disc: { conscientiousness: 1, steadiness: 2 },
                            intelligences: { logical: 1 }, // Planejamento e efici√™ncia
                            leadership: { coaching: 1 } // Priorizar seguran√ßa e plano
                        }
                    }
                ]
            },
            {
                id: 'equipment_failure',
                title: 'Falha no Equipamento!',
                description: 'Um sistema cr√≠tico da nave falhou. Requer aten√ß√£o imediata.',
                options: [
                    {
                        text: 'Reparar com pe√ßas de reposi√ß√£o (Gasta recursos, 100% sucesso)',
                        action: () => {
                            game.health += 20; // Recupera integridade
                            game.fuel = Math.max(0, game.fuel - 10); // Gasta combust√≠vel para pe√ßas
                            showMessage('Reparo bem-sucedido! A nave est√° mais √≠ntegra.');
                            return 'reparar_pecas';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { conscientiousness: 2, neuroticism: -1 }, // Organiza√ß√£o, controle
                            disc: { conscientiousness: 2, steadiness: 1 },
                            intelligences: { logical: 2 }, // Solu√ß√£o l√≥gica, passo a passo
                            leadership: { coaching: 2 } // Habilidade em resolver problemas t√©cnicos
                        }
                    },
                    {
                        text: 'Improvisar um reparo (Risco de falha, n√£o gasta recursos)',
                        action: () => {
                            if (Math.random() < 0.6) { // 60% de chance de sucesso
                                game.health += 10;
                                showMessage('O reparo improvisado funcionou, a nave est√° funcional.');
                                return 'improvisar_sucesso';
                            } else {
                                game.health = Math.max(0, game.health - 25);
                                game.crew = Math.max(0, game.crew - 1);
                                showMessage('O reparo improvisado falhou! Grandes danos e perda de um tripulante.');
                                return 'improvisar_falha';
                            }
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { openness: 2, neuroticism: 1, conscientiousness: -1 }, // Flexibilidade, risco
                            disc: { dominance: 1, influence: 1 },
                            intelligences: { logical: 1 }, // Pensamento fora da caixa
                            leadership: { delegating: 1 } // Confian√ßa na capacidade de improviso
                        }
                    }
                ]
            },
             {
                id: 'crew_morale',
                title: 'Moral da Tripula√ß√£o Baixa',
                description: 'A tripula√ß√£o est√° exausta e a moral est√° baixa, afetando o desempenho. O que fazer?',
                options: [
                    {
                        text: 'Dar um dia de folga (Consome combust√≠vel para suporte vital extra)',
                        action: () => {
                            game.fuel = Math.max(0, game.fuel - 15);
                            showMessage('A moral da tripula√ß√£o melhorou, mas voc√™ gastou mais combust√≠vel.');
                            return 'dar_folga';
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { agreeableness: 2, extraversion: 1 }, // Preocupa√ß√£o com o bem-estar
                            disc: { influence: 2, steadiness: 1 },
                            intelligences: { interpersonal: 2 }, // Habilidade social
                            leadership: { supporting: 2, coaching: 1 } // Apoio e desenvolvimento da equipe
                        }
                    },
                    {
                        text: 'Exigir que continuem trabalhando (Risco de insubordina√ß√£o ou queda de desempenho)',
                        action: () => {
                            if (Math.random() < 0.4) { // 40% de chance de queda de desempenho
                                game.health = Math.max(0, game.health - 5); // Pequeno dano por stress
                                showMessage('A tripula√ß√£o continua, mas o desempenho est√° marginalmente pior.');
                                return 'exigir_continuar_baixa_eficiencia';
                            } else {
                                showMessage('A tripula√ß√£o continua, a contragosto, mas sem perdas imediatas.');
                                return 'exigir_continuar_sem_consequencia';
                            }
                        },
                        // Mapeamento para tra√ßos
                        traits: {
                            bigFive: { conscientiousness: 2, agreeableness: -2, neuroticism: 1 }, // Foco na tarefa, menos empatia
                            disc: { dominance: 2, conscientiousness: 1 },
                            intelligences: { intrapersonal: 1, logical: 1 }, // Foco nos objetivos pr√≥prios/da miss√£o
                            leadership: { directing: 2 } // Comando e controle
                        }
                    }
                ]
            }
        ];

        let currentEvent = null;

        function showEvent(event) {
            currentEvent = event;
            eventTitle.textContent = event.title;
            eventDescription.textContent = event.description;
            option1Btn.textContent = event.options[0].text;
            option2Btn.textContent = event.options[1].text;
            decisionPanel.classList.remove('hidden');
            showMessage('Uma nova situa√ß√£o exige sua aten√ß√£o!');
            currentEventStartTime = performance.now(); // Marca o in√≠cio da decis√£o
        }

        function handleDecision(optionIndex) {
            const timeTaken = performance.now() - currentEventStartTime;
            const chosenOption = currentEvent.options[optionIndex];

            // Registrar o estado inicial antes da decis√£o
            const initialFuel = game.fuel;
            const initialHealth = game.health;
            const initialCrew = game.crew;

            const outcome = chosenOption.action(); // Aplica a a√ß√£o da op√ß√£o
            
            // Log the decision for behavioral analysis
            behavioralLog.push({
                eventId: currentEvent.id,
                decision: chosenOption.text,
                timeTaken: timeTaken,
                initialFuel: initialFuel,
                initialHealth: initialHealth,
                initialCrew: initialCrew,
                outcomeApplied: outcome, // The return value from the action function
                finalFuel: game.fuel,
                finalHealth: game.health,
                finalCrew: game.crew,
                traits: chosenOption.traits // Adiciona os tra√ßos da op√ß√£o ao log
            });

            decisionPanel.classList.add('hidden');
            game.currentMission++;
            game.eventsCompleted++;
            updateUI();

            if (!checkGameEndConditions()) {
                // Aguarda um pouco antes do pr√≥ximo evento ou fim do jogo
                setTimeout(() => {
                    if (gameRunning) {
                        triggerRandomEvent();
                    }
                }, 2000);
            }
        }

        function triggerRandomEvent() {
            if (game.currentMission > game.maxMissions) {
                return; // J√° terminou
            }
            const randomIndex = Math.floor(Math.random() * events.length);
            showEvent(events[randomIndex]);
        }

        // --- An√°lise Comportamental ---
        function analyzeBehavior() {
            // Inicializa√ß√£o dos scores para cada dimens√£o
            const bigFiveScores = {
                openness: 0, conscientiousness: 0, extraversion: 0,
                agreeableness: 0, neuroticism: 0
            };
            const discScores = {
                dominance: 0, influence: 0, steadiness: 0,
                conscientiousness: 0 // Usado como "Conformidade" para evitar confus√£o com Big Five
            };
            const intelligenceScores = {
                logical: 0, interpersonal: 0, intrapersonal: 0
            };
            const leadershipScores = {
                directing: 0, coaching: 0, supporting: 0, delegating: 0
            };

            behavioralLog.forEach(log => {
                const traits = log.traits;
                const timeTaken = log.timeTaken; // Tempo de decis√£o

                // Ajuste de pontua√ß√£o baseado no tempo de decis√£o (para Estilo de Decis√£o)
                if (timeTaken < 5000) { // Menos de 5 segundos √© mais r√°pido
                    discScores.dominance += 0.5; // Decis√µes r√°pidas podem indicar domin√¢ncia
                } else if (timeTaken > 10000) { // Mais de 10 segundos √© mais deliberado
                    discScores.conscientiousness += 0.5; // Decis√µes lentas podem indicar conformidade/an√°lise
                }

                // Acumula pontos para Big Five
                if (traits.bigFive) {
                    bigFiveScores.openness += (traits.bigFive.openness || 0);
                    bigFiveScores.conscientiousness += (traits.bigFive.conscientiousness || 0);
                    bigFiveScores.extraversion += (traits.bigFive.extraversion || 0);
                    bigFiveScores.agreeableness += (traits.bigFive.agreeableness || 0);
                    bigFiveScores.neuroticism += (traits.bigFive.neuroticism || 0);
                }

                // Acumula pontos para DISC
                if (traits.disc) {
                    discScores.dominance += (traits.disc.dominance || 0);
                    discScores.influence += (traits.disc.influence || 0);
                    discScores.steadiness += (traits.disc.steadiness || 0);
                    discScores.conscientiousness += (traits.disc.conscientiousness || 0); // Conformidade
                }

                // Acumula pontos para Intelig√™ncias M√∫ltiplas
                if (traits.intelligences) {
                    intelligenceScores.logical += (traits.intelligences.logical || 0);
                    intelligenceScores.interpersonal += (traits.intelligences.interpersonal || 0);
                    intelligenceScores.intrapersonal += (traits.intelligences.intrapersonal || 0);
                }

                // Acumula pontos para Lideran√ßa
                if (traits.leadership) {
                    leadershipScores.directing += (traits.leadership.directing || 0);
                    leadershipScores.coaching += (traits.leadership.coaching || 0);
                    leadershipScores.supporting += (traits.leadership.supporting || 0);
                    leadershipScores.delegating += (traits.leadership.delegating || 0);
                }
            });

            // --- Gerar o Perfil Big Five ---
            const getBigFiveDescription = (score, trait) => {
                if (score > 1) return `Alta tend√™ncia a ${trait}.`;
                if (score < -1) return `Baixa tend√™ncia a ${trait}.`;
                return `Tend√™ncia moderada a ${trait}.`;
            };
            document.getElementById('opennessProfile').textContent = getBigFiveDescription(bigFiveScores.openness, 'Abertura (curiosidade, criatividade)');
            document.getElementById('conscientiousnessProfile').textContent = getBigFiveDescription(bigFiveScores.conscientiousness, 'Conscienciosidade (organiza√ß√£o, responsabilidade)');
            document.getElementById('extraversionProfile').textContent = getBigFiveDescription(bigFiveScores.extraversion, 'Extrovers√£o (sociabilidade, assertividade)');
            document.getElementById('agreeablenessProfile').textContent = getBigFiveDescription(bigFiveScores.agreeableness, 'Amabilidade (coopera√ß√£o, empatia)');
            document.getElementById('neuroticismProfile').textContent = getBigFiveDescription(bigFiveScores.neuroticism, 'Neuroticismo (estabilidade emocional, ansiedade)');

            // --- Gerar o Perfil DISC ---
            const getDiscDescription = (score, trait) => {
                if (score > 1) return `Marcante ${trait}: ${discExplanations[trait].high}`;
                if (score < -1) return `Baixo(a) ${trait}: ${discExplanations[trait].low}`;
                return `Moderado(a) ${trait}: ${discExplanations[trait].moderate}`;
            };

            const discExplanations = {
                dominance: {
                    high: 'Direto(a), orientado(a) a resultados, gosta de desafios.',
                    low: 'Gentil, evitador(a) de confrontos, prefere a colabora√ß√£o.',
                    moderate: 'Equilibrado(a) entre direcionar e colaborar.'
                },
                influence: {
                    high: 'Comunicativo(a), persuasivo(a), otimista e social.',
                    low: 'Reservado(a), anal√≠tico(a), prefere fatos √† emo√ß√£o.',
                    moderate: 'Capaz de influenciar, mas tamb√©m de ouvir e analisar.'
                },
                steadiness: {
                    high: 'Paciente, est√°vel, leal, busca harmonia e seguran√ßa.',
                    low: 'Din√¢mico(a), avesso(a) √† rotina, adapt√°vel a mudan√ßas.',
                    moderate: 'Est√°vel, mas com capacidade de se adaptar quando necess√°rio.'
                },
                conscientiousness: { // Usado como Conformidade
                    high: 'Detalhes, precis√£o, segue regras, cr√≠tico(a) e anal√≠tico(a).',
                    low: 'Flex√≠vel, menos focado(a) em detalhes, pragm√°tico(a).',
                    moderate: 'Busca precis√£o, mas com pragmatismo e flexibilidade.'
                }
            };
            document.getElementById('dominanceProfile').textContent = getDiscDescription(discScores.dominance, 'dominance');
            document.getElementById('influenceProfile').textContent = getDiscDescription(discScores.influence, 'influence');
            document.getElementById('steadinessProfile').textContent = getDiscDescription(discScores.steadiness, 'steadiness');
            document.getElementById('complianceProfile').textContent = getDiscDescription(discScores.conscientiousness, 'conscientiousness'); // Mapeado para Conformidade

            // --- Gerar o Perfil de Intelig√™ncias M√∫ltiplas ---
            const getIntelligenceDescription = (score, trait) => {
                if (score > 1) return `Forte habilidade em ${trait}.`;
                if (score < -1) return `Menor foco em ${trait}.`;
                return `Habilidade moderada em ${trait}.`;
            };
            document.getElementById('logicalIntProfile').textContent = getIntelligenceDescription(intelligenceScores.logical, 'racioc√≠nio L√≥gico-Matem√°tico (an√°lise, solu√ß√£o de problemas)');
            document.getElementById('interpersonalIntProfile').textContent = getIntelligenceDescription(intelligenceScores.interpersonal, 'Intelig√™ncia Interpessoal (entender e interagir com outros)');
            document.getElementById('intrapersonalIntProfile').textContent = getIntelligenceDescription(intelligenceScores.intrapersonal, 'Intelig√™ncia Intrapessoal (autoconhecimento, reflex√£o)');

            // --- Gerar o Perfil de Lideran√ßa ---
            const getLeadershipDescription = (score, trait) => {
                if (score > 1) return `Tend√™ncia a um estilo de lideran√ßa ${trait}.`;
                if (score < -1) return `Menos propenso(a) ao estilo ${trait}.`;
                return `Potencial para um estilo de lideran√ßa ${trait}.`;
            };
            document.getElementById('directingProfile').textContent = getLeadershipDescription(leadershipScores.directing, 'Direcionador (decisivo, focado em tarefas)');
            document.getElementById('coachingProfile').textContent = getLeadershipDescription(leadershipScores.coaching, 'Coaching (orientador, desenvolvendo a equipe)');
            document.getElementById('supportingProfile').textContent = getLeadershipDescription(leadershipScores.supporting, 'Apoiador (emp√°tico, preocupado com o bem-estar)');
            document.getElementById('delegatingProfile').textContent = getLeadershipDescription(leadershipScores.delegating, 'Delegador (confia na equipe, delega responsabilidades)');

            profileReportModal.classList.remove('hidden');
        }

        // --- Inicializa√ß√£o do Jogo ---
        function resetGame() {
            game = {
                fuel: 100,
                health: 100,
                crew: 5,
                currentMission: 1,
                maxMissions: 5,
                eventsCompleted: 0,
                playerShip: { x: canvas.width / 2, y: canvas.height / 2, size: 20 }
            };
            behavioralLog.length = 0; // Limpa o log de comportamento
            updateUI();
            updateCanvas();
            showMessage('Bem-vindo(a) √† Odiss√©ia Comportamental! Clique para iniciar.');
            decisionPanel.classList.add('hidden');
            startGameBtn.classList.remove('hidden');
            profileReportModal.classList.add('hidden');
        }

        function startGame() {
            resetGame();
            gameRunning = true;
            startGameBtn.classList.add('hidden');
            showMessage('Iniciando miss√£o... Prepare-se para decis√µes!');
            setTimeout(triggerRandomEvent, 2000); // Inicia o primeiro evento ap√≥s um pequeno delay
        }

        // --- Event Listeners ---
        startGameBtn.addEventListener('click', startGame);
        option1Btn.addEventListener('click', () => handleDecision(0));
        option2Btn.addEventListener('click', () => handleDecision(1));
        restartGameBtnModal.addEventListener('click', resetGame);

        // Ajustar o canvas ao redimensionar a janela (garantindo responsividade)
        function resizeCanvas() {
            const containerWidth = canvas.parentElement.offsetWidth - 32; // Subtracting padding
            canvas.width = Math.min(800, containerWidth);
            canvas.height = canvas.width * (450 / 800); // Manter propor√ß√£o 16:9
            game.playerShip.x = canvas.width / 2;
            game.playerShip.y = canvas.height / 2;
            updateCanvas();
        }

        window.addEventListener('resize', resizeCanvas);
        window.onload = function () {
            resizeCanvas(); // Chama no carregamento inicial
            resetGame(); // Prepara o jogo
        };
    </script>
</body>
</html>
